<!DOCTYPE html>
<div class="rank-label" id="kcal-title">æœ¬æ—¥ã®æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼</div>
<div class="calorie-value"><span id="currentCalorie">0</span> kcal</div>
<div class="rank-sub">ç›®æ¨™ã¾ã§ã‚ã¨ <span id="remainingCalorie">--</span> kcal</div>
</section>


<!-- æ©Ÿèƒ½ã‚°ãƒªãƒƒãƒ‰ï¼ˆã‚¹ãƒãƒ›ã¯2åˆ—ï¼‰ -->
<nav class="feature-grid" aria-label="æ©Ÿèƒ½ä¸€è¦§">
<button class="feature-card" onclick="switchPage('meal')">ğŸ“·<span>é£Ÿäº‹è¨˜éŒ²</span></button>
<button class="feature-card" onclick="switchPage('insights')">ğŸ“Š<span>æ „é¤Šãƒã‚§ãƒƒã‚¯</span></button>
<button class="feature-card" onclick="switchPage('characters')">ğŸ‘»<span>ã‚­ãƒ£ãƒ©è‚²æˆ</span></button>
<button class="feature-card" onclick="switchPage('nutrients')">ğŸ‘¥<span>æ „é¤Šåˆ†æ</span></button>
<button class="feature-card" onclick="switchPage('akinator')">ğŸ½ï¸<span>AIçŒ®ç«‹</span></button>
<button class="feature-card" onclick="switchPage('shop')">ğŸ›’<span>ã‚·ãƒ§ãƒƒãƒ—</span></button>
</nav>
</div>


<script>
// ========= å…±é€š =========
function checkLogin() {
if (localStorage.getItem("loggedIn") !== "true") {
window.location.href = "login.html"; // æ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’æµç”¨
}
}
function logout() {
localStorage.removeItem("loggedIn");
window.location.href = "login.html";
}
function switchPage(pageName) {
window.location.href = `pages/${pageName}/index.html`;
}
function loadUserSettings() {
const userName = localStorage.getItem("username") || "ç¾é£Ÿå®¶ã•ã‚“";
document.getElementById("userName").textContent = `ã“ã‚“ã«ã¡ã¯ã€${userName}ï¼`;
const userIcon = localStorage.getItem("userIcon");
if (userIcon) document.getElementById("profileIcon").src = userIcon;
}


// mealãƒšãƒ¼ã‚¸ã¯ date ã‚’ ISO æ–‡å­—åˆ—(UTC)ã§ä¿å­˜ã—ã¦ã„ã‚‹ã®ã§ã€ãã‚Œã«åˆã‚ã›ã¦åˆ¤å®š
function isoToday() {
return new Date().toISOString().slice(0, 10); // YYYY-MM-DD
}


// ========= æœ¬æ—¥ã®ã‚«ãƒ­ãƒªãƒ¼åˆè¨ˆï¼ˆmealã®åˆè¨ˆã ã‘ã‚’é›†è¨ˆï¼‰ =========
function loadCalorieInfo() {
const calorieGoal = parseInt(localStorage.getItem("calorieGoal")) || 1580;
const todayKey = isoToday();


let totalKcal = 0;
try {
const meals = JSON.parse(localStorage.getItem("bisyokuka_meals_v2") || "[]");
totalKcal = meals
.filter(m => (m.date || "").slice(0, 10) === todayKey)
.reduce((sum, m) => sum + Number(m.totals?.kcal ?? m.kcal ?? 0), 0);
} catch {
totalKcal = 0;
}


document.getElementById("currentCalorie").textContent = totalKcal;
document.getElementById("remainingCalorie").textContent = Math.max(0, calorieGoal - totalKcal);
}


// ä»–ã‚¿ãƒ–ã§ meal ã‚’è¿½åŠ ã—ãŸå ´åˆã‚‚æ›´æ–°ï¼ˆä»»æ„ï¼‰
window.addEventListener("storage", (e) => {
if (e.key === "bisyokuka_meals_v2" || e.key === "calorieGoal") {
loadCalorieInfo();
}
if (e.key === "username" || e.key === "userIcon") {
loadUserSettings();
}
});
</script>
</body>
</html>
