<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚­ãƒ£ãƒ©è‚²æˆ | ç¾é£Ÿå®¶ã•ã‚“</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="topbar">
    <a class="btn ghost" href="../../index.html">â† ãƒ›ãƒ¼ãƒ </a>
    <h1>ğŸ® ã‚­ãƒ£ãƒ©è‚²æˆ</h1>
    <a class="btn accent" href="./dex/index.html">ğŸ“š å›³é‘‘</a>
  </header>

  <!-- ãã‚‡ã†ã®è‚²æˆã‚²ãƒ¼ã‚¸ -->
  <section class="gauge-card">
    <div class="gauge-title">ãã‚‡ã†ã®è‚²æˆã‚²ãƒ¼ã‚¸ <span id="gaugePct">0%</span></div>
    <div class="gauge-rail"><div id="gaugeBar" class="gauge-bar" style="width:0%"></div></div>
    <div id="gaugeHint" class="gauge-hint">ã¾ãšã¯1é£Ÿè¨˜éŒ²ã—ã¦ã¿ã‚ˆã†ï¼</div>
  </section>

  <!-- å·¦å³ 1:1 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
  <main class="two-col">
    <!-- å·¦ï¼šã‚­ãƒ£ãƒ© -->
    <section class="hero-col">
      <div class="bubble" id="heroBubble">ä»Šæ—¥ã®PFCãƒãƒ©ãƒ³ã‚¹ã€ã„ã„æ„Ÿã˜ï¼Ÿ</div>

      <div class="hero-stage">
        <!-- 3Ã—4 ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆï¼ˆ1ã‚³ãƒ 32Ã—32 æƒ³å®šï¼‰ -->
        <div
          id="hero"
          class="hero"
          style="background-image:url('./project-root/ç”·_ã‚¹ãƒ¼ãƒ„1.png')"
        ></div>
        <div class="shadow"></div>
      </div>
    </section>

    <!-- å³ï¼šã‚¯ã‚¨ã‚¹ãƒˆï¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ4è¡Œè¦‹åˆ‡ã‚Šï¼‰ -->
    <section class="quest-col">
      <div class="panel">
        <h2>â³ ã‚¯ã‚¨ã‚¹ãƒˆ</h2>
        <ul class="task-list">
          <li class="task">
            <div>
              <p class="task-title">ãŸã‚“ã±ãè³ª 50â€“120g ã‚’ç›®æŒ‡ã™</p>
              <div class="meta">ç¾åœ¨ <span id="metaP">0</span> g</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">è„‚è³ª 40â€“70g ã«åã‚ã‚‹</p>
              <div class="meta">ç¾åœ¨ <span id="metaF">0</span> g</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">ç‚­æ°´åŒ–ç‰© 180â€“300g ã‚’ã‚­ãƒ¼ãƒ—</p>
              <div class="meta">ç¾åœ¨ <span id="metaC">0</span> g</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">ç·ã‚«ãƒ­ãƒªãƒ¼ ç›®æ¨™Â±10% ã«</p>
              <div class="meta">ç¾åœ¨ <span id="metaK">0</span> kcal</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
        </ul>
      </div>

      <div class="panel">
        <h2>ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
        <ul class="task-list">
          <li class="task">
            <div>
              <p class="task-title">æ–°é£Ÿæã«æŒ‘æˆ¦ï¼ˆæœªç™»éŒ²ã®é£Ÿæã‚’1ã¤ï¼‰</p>
              <div class="meta">æŒ‘æˆ¦åº¦ï¼š<span id="evt1">0</span>/1</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">é‡èœã‚’ã‚‚ã†1å“è¿½åŠ ã—ã¦ã¿ã‚ˆã†</p>
              <div class="meta">æœ¬æ—¥ã®é‡èœå“ç›®ï¼š<span id="evt2">0</span></div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">æ°´åˆ† 1.5L ã‚’ç›®æŒ‡ã™</p>
              <div class="meta">æ¨å®šï¼š<span id="evt3">0</span> mL</div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
          <li class="task">
            <div>
              <p class="task-title">20æ™‚ä»¥é™ã®é–“é£Ÿã¯æ§ãˆã‚ã«</p>
              <div class="meta">ä»Šæ—¥ã¯â€¦ <span id="evt4">åˆ¤å®šå¾…ã¡</span></div>
            </div>
            <a class="action view" href="../insights/index.html">ç¢ºèªã™ã‚‹</a>
          </li>
        </ul>
      </div>
    </section>
  </main>

  <!-- æœ€å°é™ã®JSï¼šæ–¹å‘åˆ‡æ›¿ï¼ˆæ­£é¢ä¸­å¿ƒâ†’æ™‚ã€…æ¨ªå‘ãï¼‰ã¨ã‚²ãƒ¼ã‚¸ã–ã£ãã‚Šè¨ˆç®— -->
  <script>
    // ===== ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã®è¡Œï¼ˆ0=æ­£é¢, 1=å·¦, 2=å³, 3=å¾Œã‚ï¼‰ã‚’CSSã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§åˆ¶å¾¡ =====
    const hero = document.getElementById('hero');
    const setRow = (r) => hero.style.setProperty('--row', r);

    // åˆæœŸã¯æ­£é¢
    setRow(0);

    // 2ã€œ4ç§’ã”ã¨ã«ã€Œæ­£é¢70% / å·¦15% / å³15%ã€ã§ãµã‚ã£ã¨åˆ‡æ›¿
    (function idleLoop(){
      const r = Math.random();
      if (r < 0.7) setRow(0);
      else if (r < 0.85) setRow(1);
      else setRow(2);
      setTimeout(idleLoop, 2000 + Math.random()*2000);
    })();

    // ===== ã–ã£ãã‚Šã‚²ãƒ¼ã‚¸ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã® meal ã‚’å‚ç…§ï¼‰=====
    try{
      const items = JSON.parse(localStorage.getItem("bisyokuka_meals_v2")||"[]");
      const today = new Date().toISOString().slice(0,10);
      const todayItems = items.filter(m => (m.date||"").slice(0,10) === today);

      const sums = todayItems.reduce((a, m)=>({
        kcal:a.kcal + +(m.totals?.kcal||0),
        p:a.p + +(m.totals?.protein||0),
        f:a.f + +(m.totals?.fat||0),
        c:a.c + +(m.totals?.carbs||0),
      }), {kcal:0,p:0,f:0,c:0});

      // ç›®å®‰ï¼ˆé©å®œã‚¢ãƒ—ãƒªå´ã¨åˆã‚ã›ã¦ã­ï¼‰
      const target = { kcal: 1800, p: 80, f: 60, c: 240 };
      const ratio = Math.min(1,
        (sums.kcal/target.kcal + sums.p/target.p + sums.f/target.f + sums.c/target.c) / 4
      );
      const pct = Math.round(ratio*100);
      document.getElementById('gaugeBar').style.width = pct + '%';
      document.getElementById('gaugePct').textContent = pct + '%';
      document.getElementById('gaugeHint').textContent =
        `ä»Šæ—¥ã®åˆè¨ˆï¼š${sums.kcal} kcal / P${sums.p}g F${sums.f}g C${sums.c}g`;

      // å³ãƒ‘ãƒãƒ«ã®ç¾åœ¨å€¤
      document.getElementById('metaP').textContent = sums.p;
      document.getElementById('metaF').textContent = sums.f;
      document.getElementById('metaC').textContent = sums.c;
      document.getElementById('metaK').textContent = sums.kcal;
    }catch(e){}
  </script>
</body>
</html>
