:root{
  --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8;
  --accent:#22d3ee; --green:#22c55e; --blue:#3b82f6; --line:#1f2937;
}

/* reset-ish */
*{box-sizing:border-box}
html,body{height:100%}
body{ margin:0; font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
  background: var(--bg); color: var(--ink); }

/* ---------- Header ---------- */
.app-header{
  max-width:1200px; margin:16px auto 0; padding:16px 20px;
  display:grid; grid-template-columns: 1fr auto auto; gap:12px; align-items:center;
}
.app-header h1{margin:0; font-size:20px; letter-spacing:0.02em}
.nav-buttons{display:flex; gap:8px; justify-self:center}
.nav-buttons .ghost-btn{min-width:110px}
.user-summary{justify-self:end; display:flex; align-items:center; gap:16px}
.title-badge{
  background:linear-gradient(135deg,#2dd4bf,#60a5fa); color:#0b1320; font-weight:700;
  padding:6px 10px; border-radius:999px; box-shadow:0 2px 12px rgba(0,0,0,.3);
}
.xp-wrap{min-width:360px}
.xp-label{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
.xp-bar{height:10px; background:#0b1220; border-radius:999px; overflow:hidden; border:1px solid #0a1020}
.xp-bar #xpFill{height:100%; width:0%; background:linear-gradient(90deg,#22d3ee,#3b82f6); transition:width .4s ease}

/* ---------- Main Layout ---------- */
.layout{
  max-width:1200px; margin:0 auto; padding:12px 20px 24px;
  display:grid; grid-template-columns: 7fr 5fr; gap:16px;
}
.stage-card, .side-card{
  background:var(--card); border:1px solid var(--line); border-radius:16px; padding:14px;
  box-shadow: 0 6px 20px rgba(0,0,0,.25);
}

/* ---------- Stage ---------- */
.stage-toolbar{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px}
.stat{font-size:13px; color:var(--muted)}
.ghost-btn{ background:transparent; color:var(--ink); border:1px solid #263144;
  padding:6px 10px; border-radius:10px; cursor:pointer }
.ghost-btn:hover{background:#0e1625}

.stage{
  position:relative; height:420px; border-radius:12px; overflow:hidden;
  background: radial-gradient(ellipse at 30% 30%, #0f2438, #0c1827 60%);
  outline:1px solid #0c2238;
}

/* 背景グリッド */
.grid-bg{
  position:absolute; inset:0;
  background-image:
    linear-gradient(#14314d 1px, transparent 1px),
    linear-gradient(90deg, #14314d 1px, transparent 1px);
  background-size: 40px 40px; opacity:.35;
}

/* キャラ（32x32 3列 x 4行）を2倍描画 */
.char{
  position:absolute; width:64px; height:64px; left:40px; top:40px;
  image-rendering: pixelated; background-image: url("img/char.png"); background-repeat:no-repeat;
  transform: translateZ(0);
}

/* 歩行フレーム（3コマ） */
@keyframes walk-frames { from { background-position-x: 0px; } to { background-position-x: -96px; } }

/* 向き（行オフセット） */
.dir-front{ background-position-y:   0px; }
.dir-left { background-position-y: -32px; }
.dir-right{ background-position-y: -64px; }
.dir-back { background-position-y: -96px; }

/* アニメ再生 */
.char.walking{ animation: walk-frames .6s steps(3) infinite; }

/* ステージ右下 FAB */
.stage-fab{
  position:absolute; right:10px; bottom:10px; display:flex; flex-direction:column; gap:8px; z-index:2;
}
.fab{
  width:40px; height:40px; border-radius:12px; border:1px solid #203049;
  background:#0e1726; color:#e5e7eb; font-size:18px; cursor:pointer; box-shadow:0 4px 14px rgba(0,0,0,.35);
}
.fab:hover{background:#12233a}

/* ---------- Quests ---------- */
.side-card h2{margin:4px 0 10px}
.quest-list{display:flex; flex-direction:column; gap:10px}
.quest{
  border:1px solid #203049; background:#0e1726; border-radius:12px; padding:10px 12px; transition:opacity .2s;
}
.quest .top{display:flex; justify-content:space-between; align-items:center; gap:8px}
.quest .name{font-weight:600}
.quest .xp{font-size:12px; color:var(--muted)}
.quest .desc{margin:6px 0 10px; color:#b6c2d1; font-size:13px}
.quest .actions{display:flex; gap:8px}
button{cursor:pointer}
button.blue{ background:var(--blue); color:white; border:none; padding:8px 10px; border-radius:10px; font-weight:600; }
button.green{ background:var(--green); color:#06200f; border:none; padding:8px 10px; border-radius:10px; font-weight:700; }
button:disabled{opacity:.6; cursor:not-allowed}

/* 完了デザイン */
.quest.done{ opacity:.6; }
.quest.done .name{ text-decoration:line-through; }
.quest .state{ font-size:12px; color:#a5f3fc; margin-left:6px; }

/* ---------- How-to / Log / Footer ---------- */
.howto{ margin-top:12px; background:#0c1422; border:1px solid #1a2740; border-radius:12px; padding:10px 12px; color:#c8d3e1 }
.howto summary{cursor:pointer; color:#a3d9ff; font-weight:700}
.mt{margin-top:14px}
.log{margin:8px 0 0; padding-left:18px; max-height:160px; overflow:auto}
.log li{margin:4px 0; color:#c7d2fe; font-size:13px}
.app-footer{ max-width:1200px; margin:0 auto 24px; padding:12px 20px;
  display:flex; justify-content:space-between; align-items:center; color:var(--muted)}
.footer-actions{display:flex; gap:10px}

/* ---------- Responsive ---------- */
@media (max-width:1024px){
  .layout{grid-template-columns:1fr; gap:12px}
  .xp-wrap{min-width:260px}
  .stage{height:380px}
  .app-header{grid-template-columns: 1fr auto; grid-auto-rows:auto}
  .nav-buttons{justify-self:end}
}
