:root{
  --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --muted:#94a3b8;
  --accent:#22d3ee; --green:#22c55e; --blue:#3b82f6; --line:#1f2937; --orange:#f59e0b;
  --frame: 32px;
  --hero-scale: 8.2;              /* 拡大率 */
  --hero-x: 35%;                   /* 中央に配置 */
  --hero-y: 30%;                   /* 少し下に */
}

*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; font-family:system-ui, sans-serif; background:var(--bg); color:var(--ink)}

.app-header{max-width:1200px; margin:16px auto 0; padding:16px 20px;
  display:grid; grid-template-columns: 1fr auto auto; gap:12px; align-items:center;}
.nav-buttons{display:flex; gap:10px}
.nav-buttons .ghost-btn{border:none; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer}
#btnHome{background:var(--blue); color:#fff}
#btnDex{background:var(--orange); color:#171717}
.user-summary{justify-self:end; display:flex; align-items:center; gap:16px}
.title-badge{background:linear-gradient(135deg,#2dd4bf,#60a5fa); color:#0b1320; font-weight:700; padding:6px 10px; border-radius:999px}
.xp-wrap{min-width:360px}
.xp-label{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
.xp-bar{height:10px; background:#0b1220; border-radius:999px; overflow:hidden; border:1px solid #0a1020}
#xpFill{height:100%; width:0%; background:linear-gradient(90deg,#22d3ee,#3b82f6); transition:width .4s ease}

.layout{max-width:1200px; margin:0 auto; padding:12px 20px 24px; display:grid; grid-template-columns:7fr 5fr; gap:16px}
.stage-card,.side-card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:14px; box-shadow:0 6px 20px rgba(0,0,0,.25)}
.stage-toolbar{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px}
.stat{font-size:13px; color:var(--muted)}
.ghost-btn{background:transparent; color:var(--ink); border:1px solid #263144; padding:6px 10px; border-radius:10px; cursor:pointer}

.stage{position:relative; height:520px; border-radius:16px; overflow:hidden;
  background:radial-gradient(ellipse at 30% 30%, #0f2438, #0c1827 60%); outline:1px solid #0c2238}
.grid-bg{position:absolute; inset:0;
  background-image:linear-gradient(#14314d 1px,transparent 1px),linear-gradient(90deg,#14314d 1px,transparent 1px);
  background-size:40px 40px; opacity:.35}

/* ==== キャラ（静止画：正面のみ） ==== */
.char{
  position:absolute;
  left:var(--hero-x);              /* 中央寄せ */
  top:var(--hero-y);
  width:var(--frame);
  height:var(--frame);
  background-image:url('./project-root/char.png');
  background-repeat:no-repeat;
  background-position:0 0;        /* 1行目1列目 */
  image-rendering:pixelated;
  transform:translate(-50%,-100%) scale(var(--hero-scale));
  transform-origin:top left;
  z-index:2;
}
/* 念のためアニメ停止 */
.walking{ animation:none !important; }
.dir-front,.dir-left,.dir-right,.dir-back{ background-position:0 0 !important; }

/* 吹き出し（キャラの上。画面中央ではなく固定位置） */


/* キャラは今のままでOK（transform: translate(-50%,-100%) scale(...) 前提） */

/* 吹き出し（キャラの真上に常時表示） */
.speech{
  position:absolute;
  left: var(--hero-x);
  top: calc(var(--hero-y) - var(--hero-size) - var(--bubble-offset));
  transform: translateX(-50%);
  z-index: 3;

  max-width: var(--bubble-maxw);
  padding: calc(6px + (var(--hero-scale) - 1) * 1px)
           calc(10px + (var(--hero-scale) - 1) * 2px);
  font-size: calc(12px + (var(--hero-scale) - 1) * 1.2px);
  line-height: 1.25;

  background:#0f172a; color:#e5e7eb;
  border:1px solid #203049; border-radius:14px;
  transition: opacity .3s ease;  /* フェード用 */
  opacity:1;                      /* 常時表示 */
}
.speech::after{
  content:"";
  position:absolute; left:50%;
  bottom: calc(var(--bubble-tail) * -1);
  transform: translateX(-50%);
  border: var(--bubble-tail) solid transparent;
  border-top-color:#203049;
}


.stage-fab{position:absolute; right:10px; bottom:10px; display:flex; gap:8px; z-index:3}
.fab{width:40px; height:40px; border-radius:10px; border:1px solid #21304a; background:#0b1626; color:#e5e7eb; cursor:pointer; font-size:18px}

.side-card h2{margin:4px 0 10px}
.quest-list{display:flex; flex-direction:column; gap:10px}
.quest{border:1px solid #203049; background:#0e1726; border-radius:12px; padding:10px 12px}
.quest .top{display:flex; justify-content:space-between; align-items:center; gap:8px}
.quest .name{font-weight:600}
.quest .xp{font-size:12px; color:var(--muted)}
.quest .desc{margin:6px 0 10px; color:#b6c2d1; font-size:13px}
.quest .actions{display:flex; gap:8px}
button.blue{background:var(--blue); color:#fff; border:none; padding:8px 10px; border-radius:10px; font-weight:600}
button.green{background:var(--green); color:#06200f; border:none; padding:8px 10px; border-radius:10px; font-weight:700}
button:disabled{opacity:.6; cursor:not-allowed}
.quest.done{opacity:.55}
.quest.done .name{text-decoration:line-through}
.quest .state{font-size:12px; color:#a5f3fc; margin-left:6px}

.howto{margin-top:12px; background:#0c1422; border:1px solid #1a2740; border-radius:12px; padding:10px 12px; color:#c8d3e1}
.mt{margin-top:14px}
.log{margin:8px 0 0; padding-left:18px; max-height:160px; overflow:auto}
.app-footer{max-width:1200px; margin:0 auto 24px; padding:12px 20px; display:flex; justify-content:space-between; align-items:center; color:#94a3b8}

@media (max-width:1024px){
  .layout{grid-template-columns:1fr; gap:12px}
  .xp-wrap{min-width:260px}
  .stage{height:420px}
  .app-header{grid-template-columns: 1fr auto}
  .nav-buttons{justify-self:end}
}
