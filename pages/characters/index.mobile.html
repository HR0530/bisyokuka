<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>美食家さん｜キャラ育成（SP）</title>

  <!-- ★ スマホ以外(PC)で開かれたらPC版へ戻す（?view=sp がある場合はSPを優先） -->
 <script>
(function(){
  // 1) 手動指定（?view=sp / ?view=pc）を尊重
  const qs = new URLSearchParams(location.search);
  const force = (qs.get("view")||"").toLowerCase();
  if (force === "sp" || force === "pc") {
    try { localStorage.setItem("viewMode", force); } catch {}
    // クエリから view を消しておく（共有しやすく）
    qs.delete("view");
    const u = new URL(location.href); u.search = qs.toString();
    history.replaceState(null, "", u.toString());
  }

  const pref = (localStorage.getItem("viewMode")||"").toLowerCase();

  // 2) 画面の大きさ＋ポインタ特性で“モバイルっぽさ”を判定
  function wantSP(){
    const narrow = matchMedia("(max-width: 820px)").matches; // ブレークポイント
    const coarse = matchMedia("(pointer: coarse)").matches;  // 指タッチ中心
    return narrow && coarse;
  }

  // 3) 現在のファイル名（index.html / index.mobile.html）を判定
  const path = location.pathname;
  const onSP = /index\.mobile\.html$/i.test(path);
  const onPC = /index\.html$/i.test(path) && !onSP;

  // 4) 目的地を作るヘルパ
  function swapTo(file){
    const u = new URL(location.href);
    if (u.pathname.endsWith("/" + file)) return; // もう居る
    u.pathname = u.pathname.replace(/[^/]+$/, file);
    location.replace(u.toString());
  }

  // 5) 初回ロード時の分岐：手動指定 > 端末判定
  if (pref === "sp") { if (!onSP) swapTo("index.mobile.html"); return; }
  if (pref === "pc") { if (!onPC) swapTo("index.html"); return; }

  const shouldSP = wantSP();
  if (shouldSP && !onSP) swapTo("index.mobile.html");
  if (!shouldSP && !onPC) swapTo("index.html");

  // 6) 画面サイズが大きく変わったら再判定（回転・分割表示など）
  //    ※ 手動固定がある場合は何もしない
  if (!pref) {
    let timer;
    addEventListener("resize", () => {
      clearTimeout(timer);
      timer = setTimeout(() => {
        const sp = wantSP();
        if (sp && !/index\.mobile\.html$/i.test(location.pathname)) swapTo("index.mobile.html");
        if (!sp && /index\.mobile\.html$/i.test(location.pathname)) swapTo("index.html");
      }, 150);
    });
  }
})();
</script>


  <link rel="stylesheet" href="./style.mobile.css" />
</head>
<body>
  <header class="app-header">
    <button class="nav-pill" id="btnHome" title="ホーム">🏠</button>
    <h1>🍽️ キャラ育成</h1>
    <button class="nav-pill" id="btnDex" title="図鑑">📚</button>

    <div class="user-summary">
      <div class="title-badge" id="titleBadge">見習いフーディー</div>
      <div class="xp-wrap">
        <div class="xp-label">
          <span id="levelText">Lv.1</span>
          <span id="xpText">0 / 100 XP</span>
        </div>
        <div class="xp-bar"><div id="xpFill"></div></div>
      </div>
    </div>
  </header>

  <main class="layout">
    <section class="stage-card">
      <div class="stage-toolbar">
        <div class="stat"><strong>体力</strong> <span id="hpText">100</span></div>
        <div class="stat"><strong>満足度</strong> <span id="satisfactionText">50</span></div>
        <button class="ghost-btn" id="toggleRun">一時停止</button>
      </div>

      <div class="stage">
        <div class="grid-bg" aria-hidden="true"></div>

        <!-- キャラ（静止/歩行） -->
        <div id="character" class="char walking dir-front" title="主人公"></div>

        <!-- 吹き出し -->
        <div class="speech" id="speech">今日のPFCバランス、いい感じ？</div>

        <!-- 右下FAB -->
        <div class="stage-fab">
          <button class="fab" id="fabDex"  title="図鑑へ">📚</button>
          <button class="fab" id="fabHome" title="ホームへ">🏠</button>
        </div>
      </div>

      <details class="howto" open>
        <summary>称号・経験値はこう上がる（原理）</summary>
        <ul>
          <li>📷 食事記録を投稿：+20 XP（写真つき +30）</li>
          <li>🎯 カロリー目標達成：+40 XP（連続ボーナスあり）</li>
          <li>🧪 研究クエスト：各XP付与</li>
          <li>🔥 連続ログイン：日数 × 5 XP（最大 +25）</li>
        </ul>
        <div id="nutritionBadge" class="muted-line"></div>
      </details>
    </section>

    <section class="side-card">
      <h2>クエスト</h2>
      <div class="quest-list" id="questList"></div>

      <h3 class="mt">今日の活動ログ</h3>
      <ul class="log" id="activityLog"></ul>
    </section>
  </main>

  <footer class="app-footer">
    <button class="blue"  id="goInsights">分析を開く</button>
    <button class="green" id="quickClear">達成！ログをクリア</button>
    <a class="back" href="../../index.html">← ホーム</a>
  </footer>

  <script src="./main.mobile.js"></script>
</body>
</html>
